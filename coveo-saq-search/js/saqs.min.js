var SAQS;!function(e){var t;!function(e){var t;!function(e){e.BASE_URL="https://cloudplatform.coveo.com",e.SEARCH_URI=e.BASE_URL+"/rest/search"}(t=e.API||(e.API={}))}(t=e.Const||(e.Const={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(e){var t;!function(e){e.addFilter="filter.add",e.afterAddFilter="filter.add.after",e.removeFilter="filter.remove",e.afterRemoveFilter="filter.remove.after",e.applyFilters="filter.apply",e.afterApplyFilters="filter.apply.after",e.loadProducts="product.load"}(t=e.Events||(e.Events={}))}(t=e.Const||(e.Const={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(e){var t;!function(e){e.Sort={ASC:"fieldAscending",DESC:"fieldDescending"},e.ON_SPECIAL={title:"On Special",type:"checkbox",category:"tpspecial",options:[{category:"tpspecial",key:"on-special",label:"Only",bcDisplay:"On Special",value:!1,multi:!1}]},e.PRICE={title:"Price Range",type:"range",category:"tpprice",options:[{category:"tpprice",key:"price-range",label:"",multi:!1,value:{min:0,max:1e3}}]},e.CATEGORY={title:"Category",type:"checkbox",category:"tptype",options:[{category:"tptype",key:"type_red-wine",label:"Red Wine",value:!1,multi:!0},{category:"tptype",key:"type_white-wine",label:"White Wine",value:!1,multi:!0},{category:"tptype",key:"type_whisky",label:"Whisky",value:!1,multi:!0},{category:"tptype",key:"type_bourbon",label:"Bourbon",value:!1,multi:!0}]},e.REGION={title:"Region",type:"checkbox",category:"tpregion",options:[{category:"tpregion",key:"region_california",label:"California",value:!1,multi:!0},{category:"tpregion",key:"region_toscane",label:"Toscane",value:!1,multi:!0}]},e.COUNTRY={title:"Country",type:"checkbox",category:"tppays",options:[{category:"tppays",key:"country_france",label:"France",value:!1,multi:!0},{category:"tppays",key:"country_us",label:"U.S.",value:!1,multi:!0},{category:"tppays",key:"country_italy",label:"Italy",value:!1,multi:!0}]},e.ALL_FILTERS=[e.ON_SPECIAL,e.PRICE,e.CATEGORY,e.REGION,e.COUNTRY]}(t=e.Filters||(e.Filters={}))}(t=e.Const||(e.Const={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(e){var t;!function(e){var t="/coveo-saq-search/templates/";e.HOME_TPL=t+"home.html",e.NOT_FOUND_TPL=t+"not-found.html",e.SEARCH_BAR_TPL=t+"directives/search-bar.html",e.SIDE_FILTER_TPL=t+"directives/side-filter.html",e.PRODUCT_FILTER_TPL=t+"directives/product-filter.html",e.PRODUCT_LIST_TPL=t+"directives/product-list.html",e.BREADCRUMB_TPL=t+"directives/breadcrumbs.html"}(t=e.Templates||(e.Templates={}))}(t=e.Const||(e.Const={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t=e.Const.Templates;angular.module("saqs.services",[]),angular.module("saqs.directives",[]),angular.module("saqs",["ngRoute","saqs.services","saqs.directives"]),angular.module("saqs").constant("_",_),angular.module("saqs").config(["$routeProvider","$compileProvider",function(e,r){r.debugInfoEnabled(!1),e.when("/",{templateUrl:t.HOME_TPL}).otherwise({templateUrl:t.NOT_FOUND_TPL})}])}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(t){var r=e.Const.Templates;angular.module("saqs.directives").directive("breadCrumbs",["EventBus",function(t){return{restrict:"E",scope:{},templateUrl:r.BREADCRUMB_TPL,link:function(r){r.crumbs=[],r.removeCrumb=function(r){t.publish(e.Const.Events.removeFilter,r)},t.subscribe(e.Const.Events.addFilter,r,function(e){var t=_.findIndex(r.crumbs,{key:e.key});t>-1&&r.crumbs.splice(t,1),e.bcDisplay!==!1&&r.crumbs.push(e)}),t.subscribe(e.Const.Events.removeFilter,r,function(e){r.crumbs.splice(_.findIndex(r.crumbs,{key:e.key}),1)})}}}])}(t=e.Directives||(e.Directives={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(t){var r=e.Const.Templates;angular.module("saqs.directives").directive("productFilter",["_","DB","EventBus",function(t,i,n){return{restrict:"E",scope:{filter:"="},templateUrl:r.PRODUCT_FILTER_TPL,link:function(t){t.onChange=function(t,r){switch(r.type){case"checkbox":var i=t.value===!0?e.Const.Events.addFilter:e.Const.Events.removeFilter;n.publish(i,t)}}}}}])}(t=e.Directives||(e.Directives={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(t){var r=e.Const.Templates;angular.module("saqs.directives").directive("productList",["$window","DB",function(e,t){return{restrict:"E",scope:{},templateUrl:r.PRODUCT_LIST_TPL,link:function(r){r.products=t.getProducts(),r.openProduct=function(t){t&&t.clickUri&&e.open(t.clickUri)}}}}])}(t=e.Directives||(e.Directives={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(t){var r=e.Const.Templates;angular.module("saqs.directives").directive("searchBar",["EventBus","Filter",function(t,i){return{restrict:"E",scope:{},templateUrl:r.SEARCH_BAR_TPL,link:function(r,i){t.publish(e.Const.Events.applyFilters);var n=i.find("input");n.bind("keydown",function(r){if(13===r.which){var i=n.val();t.publish(e.Const.Events.addFilter,{category:"main-search",key:"main-search",label:"",bcDisplay:i,multi:!1,value:i}),n.val("")}})}}}])}(t=e.Directives||(e.Directives={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(t){var r=e.Const.Templates;angular.module("saqs.directives").directive("sideFilter",[function(){return{restrict:"E",scope:{},templateUrl:r.SIDE_FILTER_TPL,link:function(t){t.filters=e.Const.Filters.ALL_FILTERS}}}])}(t=e.Directives||(e.Directives={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(t){var r,i=function(){function t(t,i,n){this.$parse=t,this._=i,this.EventBus=n,r=this,r._db={filters:{},products:[],sort:{field:"tpmillesime",dir:e.Const.Filters.Sort.DESC},paging:{offset:0,limit:10}},n.subscribe(e.Const.Events.addFilter,r,r.addFilter),n.subscribe(e.Const.Events.removeFilter,r,r.removeFilter),n.subscribe(e.Const.Events.loadProducts,r,r.loadProducts)}return t.prototype.addFilter=function(t){t&&(t.multi?(r._db.filters[t.category]=r._db.filters[t.category]||[],r._db.filters[t.category].push(t)):r._db.filters[t.category]=t,r.EventBus.publish(e.Const.Events.afterAddFilter,t),r.EventBus.publish(e.Const.Events.applyFilters))},t.prototype.removeFilter=function(t){var i=r._db.filters;if(i&&i[t.category]){if(t.multi){var n=i[t.category];n.splice(_.findIndex(n,{key:t.key}),1),0===n.length&&delete i[t.category]}else delete i[t.category];r.EventBus.publish(e.Const.Events.afterRemoveFilter,t),r.EventBus.publish(e.Const.Events.applyFilters)}var s=r._.findIndex(e.Const.Filters.ALL_FILTERS,{category:t.category}),o=e.Const.Filters.ALL_FILTERS[s];if(o)if(t.multi){if(s=r._.findIndex(o.options,{key:t.key}),o.options[s])switch(o.type){case"checkbox":o.options[s].value=!1}}else switch(o.type){case"checkbox":o.options[0].value=!1}},t.prototype.loadProducts=function(e){var t=r.getProducts();t.splice(0,t.length),t.push.apply(t,e)},t.prototype.getFilters=function(){return r.$parse("_db.filters")(r)},t.prototype.getProducts=function(){return r.$parse("_db.products")(r)},t.prototype.getSorting=function(){return r.$parse("_db.sort")(r)},t.prototype.getPaging=function(){return r.$parse("_db.paging")(r)},t}();i.$inject=["$parse","_","EventBus"],t.DB=i,angular.module("saqs.services").service("DB",i)}(t=e.Services||(e.Services={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(e){var t,r=function(){function e(){t=this,t._topics={},t._subUid=-1}return e.prototype.subscribe=function(e,r,i,n){t._topics[e]||(t._topics[e]=[]);var s=(++t._subUid).toString();return t._topics[e].push({token:s,handler:i,scope:r,priority:n||1e4}),s},e.prototype.publish=function(e,r){if(!t._topics[e])return!1;var i=t._topics[e],n=i?i.length:0;return n>0&&i.sort(function(e,t){return e.priority-t.priority}).forEach(function(e){angular.isFunction(e.handler)&&e.handler.call(e.scope,r)}),!0},e.prototype.unsubscribe=function(e){for(var r in t._topics)if(t._topics[r])for(var i=0,n=t._topics[r].length;i<n;i++)if(t._topics[r][i].token===e)return t._topics[r].splice(i,1),!0;return!1},e}();e.EventBus=r,angular.module("saqs.services").service("EventBus",r)}(t=e.Services||(e.Services={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(t){var r,i=function(){function t(t,i,n){this.EventBus=t,this.DB=i,this.Product=n,r=this,t.subscribe(e.Const.Events.applyFilters,r,r.applyFilters)}return t.prototype.applyFilters=function(){var t=r.DB.getFilters(),i=Object.keys(t).map(function(e){return t[e]}),n={filters:i,sort:r.DB.getSorting(),paging:r.DB.getPaging()};r.Product.search(n).then(function(t){r.EventBus.publish(e.Const.Events.loadProducts,t.results)}).catch(function(e){alert("Error searching for products")})},t}();i.$inject=["EventBus","DB","Product"],t.Filter=i,angular.module("saqs.services").service("Filter",i)}(t=e.Services||(e.Services={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(e){var t,r=function(){function e(e,r,i,n){this.$q=e,this.$http=r,this.EventBus=i,this.ReqBuilder=n,t=this}return e.prototype.search=function(e){var r=t.$q.defer(),i=t.ReqBuilder.getUri(e),n=t.ReqBuilder.getData(e);return t.$http.post(i,n).then(function(e){r.resolve(e.data)}).catch(function(e){r.reject(e)}),r.promise},e}();r.$inject=["$q","$http","EventBus","ReqBuilder"],e.Product=r,angular.module("saqs.services").service("Product",r)}(t=e.Services||(e.Services={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(t){var r,i=function(){function t(){this.defaultSearchReqData={aq:"",searchHub:"default",language:"en",pipeline:"default",firstResult:0,numberOfResults:10,excerptLength:200,filterField:null,enableDidYouMean:!0,sortCriteria:"fieldDescending",sortField:"@tpmillesime",queryFunctions:[],rankingFunctions:[],retrieveFirstSentences:!0,timezone:"America/New_York",enableDuplicateFiltering:!1,enableCollaborativeRating:!1},r=this}return t.prototype.getUri=function(t){return e.Const.API.SEARCH_URI+"?"+r.getApiKey()+"&errorsAsSuccess=1"},t.prototype.getData=function(e){var t=angular.extend({},r.defaultSearchReqData,{aq:r.getFilters(e.filters),sortField:"@"+e.sort.field,sortCriteria:e.sort.dir});return t},t.prototype.getApiKey=function(){var e=window.ACCESS_TOKEN||"";return"access_token="+e},t.prototype.getFilters=function(e){return e.reduce(function(e,t){return e+="(@"+t.category+"=="+t.value+")"},"")},t}();t.ReqBuilder=i,angular.module("saqs.services").service("ReqBuilder",i)}(t=e.Services||(e.Services={}))}(SAQS||(SAQS={}));