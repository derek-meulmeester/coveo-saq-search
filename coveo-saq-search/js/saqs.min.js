var SAQS;!function(e){var t;!function(e){var t;!function(e){e.BASE_URL="https://cloudplatform.coveo.com",e.SEARCH_URI=e.BASE_URL+"/rest/search"}(t=e.API||(e.API={}))}(t=e.Const||(e.Const={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(e){var t;!function(e){e.addFilter="filter.add",e.afterAddFilter="filter.add.after",e.removeFilter="filter.remove",e.afterRemoveFilter="filter.remove.after",e.applyFilters="filter.apply",e.afterApplyFilters="filter.apply.after",e.loadProducts="product.load"}(t=e.Events||(e.Events={}))}(t=e.Const||(e.Const={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(e){var t;!function(e){e.Sort={ASC:"fieldAscending",DESC:"fieldDescending"},e.ON_SPECIAL={title:"On Special",type:"checkbox",category:"tpspecial",options:[{category:"tpspecial",key:"on-special",label:"Only",bcDisplay:"On Special",value:!1,multi:!1}]},e.PRICE={title:"Price Range",type:"range",category:"tpprice",options:[{category:"tpprice",key:"price-range",label:"",multi:!1,value:{min:0,max:1e3}}]},e.CATEGORY={title:"Category",type:"checkbox",category:"tptype",options:[{category:"tptype",key:"type_red-wine",label:"Red Wine",value:!1,multi:!0},{category:"tptype",key:"type_white-wine",label:"White Wine",value:!1,multi:!0},{category:"tptype",key:"type_whisky",label:"Whisky",value:!1,multi:!0},{category:"tptype",key:"type_bourbon",label:"Bourbon",value:!1,multi:!0}]},e.REGION={title:"Region",type:"checkbox",category:"tpregion",options:[{category:"tpregion",key:"region_california",label:"California",value:!1,multi:!0},{category:"tpregion",key:"region_toscane",label:"Toscane",value:!1,multi:!0}]},e.COUNTRY={title:"Country",type:"checkbox",category:"tppays",options:[{category:"tppays",key:"country_france",label:"France",value:!1,multi:!0},{category:"tppays",key:"country_us",label:"U.S.",value:!1,multi:!0},{category:"tppays",key:"country_italy",label:"Italy",value:!1,multi:!0}]},e.ALL_FILTERS=[e.ON_SPECIAL,e.PRICE,e.CATEGORY,e.REGION,e.COUNTRY]}(t=e.Filters||(e.Filters={}))}(t=e.Const||(e.Const={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(e){var t;!function(e){var t="/coveo-saq-search/templates/";e.HOME_TPL=t+"home.html",e.NOT_FOUND_TPL=t+"not-found.html",e.SEARCH_BAR_TPL=t+"directives/search-bar.html",e.SIDE_FILTER_TPL=t+"directives/side-filter.html",e.PRODUCT_FILTER_TPL=t+"directives/product-filter.html",e.PRODUCT_LIST_TPL=t+"directives/product-list.html",e.BREADCRUMB_TPL=t+"directives/breadcrumbs.html",e.PAGING_TPL=t+"directives/paging.html"}(t=e.Templates||(e.Templates={}))}(t=e.Const||(e.Const={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t=e.Const.Templates;angular.module("saqs.services",[]),angular.module("saqs.directives",[]),angular.module("saqs",["ngRoute","saqs.services","saqs.directives"]),angular.module("saqs").constant("_",_),angular.module("saqs").config(["$routeProvider","$compileProvider",function(e,i){i.debugInfoEnabled(!1),e.when("/",{templateUrl:t.HOME_TPL}).otherwise({templateUrl:t.NOT_FOUND_TPL})}])}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(t){var i=e.Const.Templates;angular.module("saqs.directives").directive("breadCrumbs",["EventBus",function(t){return{restrict:"E",scope:{},templateUrl:i.BREADCRUMB_TPL,link:function(i){i.itemCount=0,i.totalItemCount=0,i.crumbs=[],i.removeCrumb=function(i){t.publish(e.Const.Events.removeFilter,i)},i.removeAll=function(){var r=angular.copy(i.crumbs);r.forEach(function(i){i.skipApply=!0,t.publish(e.Const.Events.removeFilter,i)}),t.publish(e.Const.Events.applyFilters)},t.subscribe(e.Const.Events.addFilter,i,function(e){var t=_.findIndex(i.crumbs,{key:e.key});t>-1&&i.crumbs.splice(t,1),e.bcDisplay!==!1&&i.crumbs.push(e)}),t.subscribe(e.Const.Events.removeFilter,i,function(e){i.crumbs.splice(_.findIndex(i.crumbs,{key:e.key}),1)}),t.subscribe(e.Const.Events.loadProducts,i,function(e){i.itemCount=e.results.length,i.totalItemCount=e.totalCount})}}}])}(t=e.Directives||(e.Directives={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(t){var i=e.Const.Templates;angular.module("saqs.directives").directive("paging",["EventBus","DB",function(t,r){return{restrict:"E",scope:{},templateUrl:i.PAGING_TPL,link:function(i){i.curPage=1,i.totalPages=1,i.first=function(){var n=r.getPaging();r.setPaging({limit:n.limit,offset:0}),t.publish(e.Const.Events.applyFilters),i.curPage=1},i.prev=function(){var n=r.getPaging(),s=n.offset-n.limit;r.setPaging({limit:n.limit,offset:s<0?0:s}),t.publish(e.Const.Events.applyFilters),i.curPage>1&&(i.curPage-=1)},i.next=function(){var n=r.getPaging(),s=n.offset+n.limit;r.setPaging({limit:n.limit,offset:s>i.totalPages?i.totalPages:s}),t.publish(e.Const.Events.applyFilters),i.curPage<i.totalPages&&(i.curPage+=1)},i.last=function(){var n=r.getPaging();r.setPaging({limit:n.limit,offset:990}),t.publish(e.Const.Events.applyFilters),i.curPage=i.totalPages-1},t.subscribe(e.Const.Events.loadProducts,i,function(e){var t=r.getPaging();i.totalPages=Math.ceil(e.totalCount/t.limit),0===e.results.length?i.curPage=0:i.curPage=Math.floor(t.offset/t.limit)+1})}}}])}(t=e.Directives||(e.Directives={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(t){var i=e.Const.Templates;angular.module("saqs.directives").directive("productFilter",["_","DB","EventBus",function(t,r,n){return{restrict:"E",scope:{filter:"="},templateUrl:i.PRODUCT_FILTER_TPL,link:function(t){t.onChange=function(t,i){switch(i.type){case"checkbox":var r=t.value===!0?e.Const.Events.addFilter:e.Const.Events.removeFilter;n.publish(r,t)}}}}}])}(t=e.Directives||(e.Directives={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(t){var i=e.Const.Templates;angular.module("saqs.directives").directive("productList",["$window","DB",function(e,t){return{restrict:"E",scope:{},templateUrl:i.PRODUCT_LIST_TPL,link:function(i){i.products=t.getProducts(),i.openProduct=function(t){t&&t.clickUri&&e.open(t.clickUri)}}}}])}(t=e.Directives||(e.Directives={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(t){var i=e.Const.Templates;angular.module("saqs.directives").directive("searchBar",["EventBus","Filter",function(t,r){return{restrict:"E",scope:{},templateUrl:i.SEARCH_BAR_TPL,link:function(i,r){t.publish(e.Const.Events.applyFilters);var n=r.find("input");n.bind("keydown",function(i){if(13===i.which){var r=n.val();t.publish(e.Const.Events.addFilter,{category:"main-search",key:"main-search",label:"",bcDisplay:r,multi:!1,value:r}),n.val("")}})}}}])}(t=e.Directives||(e.Directives={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(t){var i=e.Const.Templates;angular.module("saqs.directives").directive("sideFilter",[function(){return{restrict:"E",scope:{},templateUrl:i.SIDE_FILTER_TPL,link:function(t){t.filters=e.Const.Filters.ALL_FILTERS}}}])}(t=e.Directives||(e.Directives={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(t){var i,r=function(){function t(t,r,n){this.$parse=t,this._=r,this.EventBus=n,i=this,i._db={filters:{},products:[],sort:{field:"tpmillesime",dir:e.Const.Filters.Sort.DESC},paging:{offset:0,limit:10}},n.subscribe(e.Const.Events.addFilter,i,i.addFilter),n.subscribe(e.Const.Events.removeFilter,i,i.removeFilter),n.subscribe(e.Const.Events.loadProducts,i,i.loadProducts)}return t.prototype.addFilter=function(t){t&&(t.multi?(i._db.filters[t.category]=i._db.filters[t.category]||[],i._db.filters[t.category].push(t)):i._db.filters[t.category]=t,i.EventBus.publish(e.Const.Events.afterAddFilter,t),i.EventBus.publish(e.Const.Events.applyFilters))},t.prototype.removeFilter=function(t){var r=i._db.filters;if(r&&r[t.category]){if(t.multi){var n=r[t.category];n.splice(_.findIndex(n,{key:t.key}),1),0===n.length&&delete r[t.category]}else delete r[t.category];i.EventBus.publish(e.Const.Events.afterRemoveFilter,t),t.skipApply!==!0&&i.EventBus.publish(e.Const.Events.applyFilters)}var s=i._.findIndex(e.Const.Filters.ALL_FILTERS,{category:t.category}),o=e.Const.Filters.ALL_FILTERS[s];if(o)if(t.multi){if(s=i._.findIndex(o.options,{key:t.key}),o.options[s])switch(o.type){case"checkbox":o.options[s].value=!1}}else switch(o.type){case"checkbox":o.options[0].value=!1}},t.prototype.loadProducts=function(e){var t=e.results,r=i.getProducts();r.splice(0,r.length),r.push.apply(r,t)},t.prototype.getFilters=function(){return i.$parse("_db.filters")(i)},t.prototype.getProducts=function(){return i.$parse("_db.products")(i)},t.prototype.getSorting=function(){return i.$parse("_db.sort")(i)},t.prototype.getPaging=function(){return i.$parse("_db.paging")(i)},t.prototype.setPaging=function(e){i._db.paging=e},t}();r.$inject=["$parse","_","EventBus"],t.DB=r,angular.module("saqs.services").service("DB",r)}(t=e.Services||(e.Services={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(e){var t,i=function(){function e(){t=this,t._topics={},t._subUid=-1}return e.prototype.subscribe=function(e,i,r,n){t._topics[e]||(t._topics[e]=[]);var s=(++t._subUid).toString();return t._topics[e].push({token:s,handler:r,scope:i,priority:n||1e4}),s},e.prototype.publish=function(e,i){if(!t._topics[e])return!1;var r=t._topics[e],n=r?r.length:0;return n>0&&r.sort(function(e,t){return e.priority-t.priority}).forEach(function(e){angular.isFunction(e.handler)&&e.handler.call(e.scope,i)}),!0},e.prototype.unsubscribe=function(e){for(var i in t._topics)if(t._topics[i])for(var r=0,n=t._topics[i].length;r<n;r++)if(t._topics[i][r].token===e)return t._topics[i].splice(r,1),!0;return!1},e}();e.EventBus=i,angular.module("saqs.services").service("EventBus",i)}(t=e.Services||(e.Services={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(t){var i,r=function(){function t(t,r,n){this.EventBus=t,this.DB=r,this.Product=n,i=this,t.subscribe(e.Const.Events.applyFilters,i,i.applyFilters)}return t.prototype.applyFilters=function(){var t=i.DB.getFilters(),r=Object.keys(t).map(function(e){return t[e]}),n={filters:r,sort:i.DB.getSorting(),paging:i.DB.getPaging()};i.Product.search(n).then(function(t){i.EventBus.publish(e.Const.Events.loadProducts,t)}).catch(function(e){alert("Error searching for products")})},t}();r.$inject=["EventBus","DB","Product"],t.Filter=r,angular.module("saqs.services").service("Filter",r)}(t=e.Services||(e.Services={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(e){var t,i=function(){function e(e,i,r,n){this.$q=e,this.$http=i,this.EventBus=r,this.ReqBuilder=n,t=this}return e.prototype.search=function(e){var i=t.$q.defer(),r=t.ReqBuilder.getUri(e),n=t.ReqBuilder.getData(e);return t.$http.post(r,n).then(function(e){i.resolve(e.data)}).catch(function(e){i.reject(e)}),i.promise},e}();i.$inject=["$q","$http","EventBus","ReqBuilder"],e.Product=i,angular.module("saqs.services").service("Product",i)}(t=e.Services||(e.Services={}))}(SAQS||(SAQS={}));var SAQS;!function(e){var t;!function(t){var i,r=function(){function t(){this.defaultSearchReqData={aq:"",searchHub:"default",language:"en",pipeline:"default",firstResult:0,numberOfResults:10,excerptLength:200,filterField:null,enableDidYouMean:!0,sortCriteria:"fieldDescending",sortField:"@tpmillesime",queryFunctions:[],rankingFunctions:[],retrieveFirstSentences:!0,timezone:"America/New_York",enableDuplicateFiltering:!1,enableCollaborativeRating:!1},i=this}return t.prototype.getUri=function(t){return e.Const.API.SEARCH_URI+"?"+i.getApiKey()+"&errorsAsSuccess=1"},t.prototype.getData=function(e){var t=angular.extend({},i.defaultSearchReqData,{aq:i.getFilters(e.filters),sortField:"@"+e.sort.field,sortCriteria:e.sort.dir,firstResult:e.paging.offset,numberOfResults:e.paging.limit});return t},t.prototype.getApiKey=function(){var e=window.ACCESS_TOKEN||"";return"access_token="+e},t.prototype.getFilters=function(e){return e.reduce(function(e,t){return e+="(@"+t.category+"=="+t.value+")"},"")},t}();t.ReqBuilder=r,angular.module("saqs.services").service("ReqBuilder",r)}(t=e.Services||(e.Services={}))}(SAQS||(SAQS={}));